networks:
  app_network:
    driver: bridge

services:      
  warden:
    build:
      context: .
      dockerfile: DockerWarden/Dockerfile
    ports:
      - "${WARDEN_PORT:-7139}:7139"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /usr/bin/docker:/usr/bin/docker
    privileged: true
    networks:
      - app_network
    stop_grace_period: 10s
    
  executor:
    build:
      context: .
      dockerfile: ExecutorService/Dockerfile
    ports:
      - "${EXECUTOR_PORT:-1337}:1337"
    environment:
      - HOST_NAME=${HOST_NAME}
    extra_hosts:
      - "postgres-host:host-gateway"
    volumes:
      - /dev/kvm:/dev/kvm
#dude... work ts out
    cap_add:
      - SYS_ADMIN
    privileged: true
    env_file:
      - .env
    networks:
      - app_network
    stop_grace_period: 5s

volumes:
  postgres_data:
